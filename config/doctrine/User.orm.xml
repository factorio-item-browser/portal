<doctrine-mapping
    xmlns="http://doctrine-project.org/schemas/orm/doctrine-mapping"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://doctrine-project.org/schemas/orm/doctrine-mapping
                        https://www.doctrine-project.org/schemas/orm/doctrine-mapping.xsd"
>
    <entity name="FactorioItemBrowser\Portal\Database\Entity\User">
        <options>
            <option name="comment">The table holding the user data.</option>
        </options>

        <unique-constraints>
            <unique-constraint columns="sessionId" />
        </unique-constraints>

        <id name="id" type="integer">
            <generator />
            <options>
                <option name="unsigned">true</option>
                <option name="comment">The ID of the user.</option>
            </options>
        </id>

        <field name="locale" length="5">
            <options>
                <option name="comment">The locale the user uses.</option>
            </options>
        </field>

        <field name="enabledModNames" type="json">
            <options>
                <option name="comment">The mods the user wants to have enabled.</option>
            </options>
        </field>

        <field name="recipeMode" column-definition="ENUM('hybrid','normal','expensive')">
            <options>
                <option name="default">hybrid</option>
                <option name="comment">The recipe mode the user wants to use.</option>
            </options>
        </field>

        <field name="lastVisit" type="datetime" column-definition="TIMESTAMP">
            <options>
                <option name="default">CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</option>
                <option name="comment">The timestamp when the user last visited.</option>
            </options>
        </field>

        <field name="isFirstVisit" type="boolean">
            <options>
                <option name="comment">Whether this is the first visit of the user.</option>
            </options>
        </field>

        <field name="sessionId" length="32">
            <options>
                <option name="fixed">true</option>
                <option name="comment">The session ID for the user.</option>
            </options>
        </field>

        <field name="apiAuthorizationToken" type="text">
            <options>
                <option name="comment">The API authorization token of the user.</option>
            </options>
        </field>

        <field name="sessionData" type="json" column-definition="LONGTEXT">
            <options>
                <option name="comment">The data of the user session.</option>
            </options>
        </field>

        <one-to-many
            field="sidebarEntities"
            target-entity="FactorioItemBrowser\Portal\Database\Entity\SidebarEntity"
            mapped-by="user"
            fetch="EAGER"
        />
    </entity>
</doctrine-mapping>
